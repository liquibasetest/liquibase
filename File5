from pyspark.context import SparkContext
from awsglue.context import GlueContext
from awsglue.dynamicframe import DynamicFrame

# Create a Spark session
spark = SparkSession.builder \
    .appName("InsertDataIntoIcebergTable") \
    .getOrCreate()

# Create GlueContext
glueContext = GlueContext(SparkContext.getOrCreate())

# Define your source data
source_data = glueContext.create_dynamic_frame.from_catalog(database="your_database", table_name="your_source_table")

# Convert DynamicFrame to DataFrame
dataframe = source_data.toDF()

# Register DataFrame as a temporary table
dataframe.createOrReplaceTempView("temp_source_table")

# Write Spark SQL for insertion
insert_sql = """
INSERT INTO TABLE your_iceberg_table
SELECT *
FROM temp_source_table
"""

# Execute the insert SQL statement
spark.sql(insert_sql)

# Stop Spark session
spark.stop()
